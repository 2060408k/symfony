# Insert Object

If we wanted our users to be able to add new genuses into the system whenever a new genus is discovered or organized, how would we do that?  Well, we’d probably have a new URL like /genus/new.  The user would see a form.  They’d hit submit and that would go into the database.  So, we’re not gunna get all of the way there right now, but that’s exactly how we’re gunna start.  So, in Genus Controller make a new action called with the URL /genus/new. And I won’t give it a name yet.  Now real quick, unrelated to Doctrine, notice that I put this newAction above showAction.  Remember routes match from top to bottom.  

So, if I had put /genus/new below showAction then when we went to /genus/new it would actually match this route.  Passing new in as the genus name.  So, you wanna have your more specific routes up top so that they match and your generic ones below that.  Instead of creating a form all you’re gunna do now is literally create a new genus object in here and save it to the database.  Skipping the whole form part.  Just so we can get some data in there and see how it works.  So quite literally with Doctrine when you wanna insert something you create your new object.  And then you just put data on it.  

So, in our case the only data that we really have is our name.  It’s a private property right now.  So, we can’t actually set data on it.  So, I’m gunna go down here.  Go to my Generate menu which is command N on a Mac.  Go down to Getters and Setters.  I only really need the Setter, but I’ll add the Getter too.  And now I can say genus–>setName and let’s call it octopus and maybe even make it a little bit random so that we get some interesting results.  Okay, so we have our object.  It’s populated with data.  The last thing we need to do is say “Hey Doctrine.  I want you to save this to our genus table.”  

Now for as powerful as Doctrine is everything comes back down to a single object – a single service in Doctrine called the entity manager.  No matter what you want to do – save or query or anything else, you’re probably going to first need to get the entity manager.  In the controller there’s a shortcut to get it so I’ll say $em = $this–>getDoctrine( ) –>getManager( );.  So, there’s our entity manager service.  And to save something you’re gunna call em –>persist and pass in want you wanna say and then em –>flush.  Now why two calls here instead of just something like save?  


Well, the first persist tells Doctrine that you wanna save this, but it doesn’t actually make the query yet.  Then, finally when you call flush, that’s when it makes the query.  It’s done this way in case you need to flush, save multiple objects.  You can persist a bunch of objects at once and then flush them all at once for a super-fast query to the database.  All right and then remember what does our controller always return?  A response object.  So, for simplicity I’m not gunna render a template like we’re doing below.  I’m just going to return a new response object from http foundation.  It’ll say genus created.  

All right, you guys ready?  Let’s try it out – /genus/new.  Okay.  It looks like it worked.  No errors, that’s cool.  But notice there’s also no web debug toolbar on the bottom which has a nice feature that allows us to see what queries were just made.  And the reason it doesn’t have a web debug tool bar is that we need to have a valid HTML page in order for that to show up.  So, for now let’s just kinda cheat and make a valid HTML page.  Refresh and there’s our web debug tool bar.  And if you go down here you can actually see there were three database queries made.  And really it’s just one start transaction and there is our insert into genus.  

And you can view that query in a formatted way.  A runnable version of it or even you can run an explain query on that to see if it’s a well written query.  And then to really make sure this worked, let’s actually check in the database.  There’s actually a – if you wanna make just a random sql calls in your database you’re gunna course through them directly.  But there’s also a Doctrine query sql command.  So, you can say ‘select * from genus’ and there they are.  So, adding objects with Doctrine.  Pretty darn easy. 
