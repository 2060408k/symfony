# Many to Many Setup

I want to look at 2 [entities 00:00:02] in particular. First is genus and the second is user. Now, before this tutorial I updated our fixtures file so that, of course, we have genuses and we have users but actually we have 2 types of users now. Some are normal users but others have this is scientist flag set to true. Which means that sometimes we have normal users in our system but some of our users are actually scientists themselves. This is nothing more than a simple Boolean field.

Now that we know that our system is going to be used by scientists we want to join user and genus. When a user is a scientist they probably study several different genuses and each genus is probably studied by many different users. If we want to be able to make a map in our database that records which users are studying which genuses than we can't do this with the normal many to one collection. This has to be a many to many collection. Many users study many genuses and many genuses are studied by many users.

The way this is done in a relational database is with a joined table. You have the genus table and you have the user table and when you want to relate them you actually have a new middle table. As a genus ID, [foreign 00:02:01] key back to genus, and a user ID foreign key back to user. No matter what framework or what language you're using this is always how a many to many language is stored in the database. How do we this in doctrine? It's a lot simpler than you would think.

First, start with either of your 2 genuses. I'll show you why you would choose one versus the other later. Then just add a new property. Private genus scientists. Which is just the name I'm giving for the collection of users that study this genus. Above that we're going to add an annotation for many to many with target entity equals user and because this is going to be an array of genus scientists, anytime you have that with doctrine in the construct method you want to set that to a new array collection. That is actually it.

This is a little bit confusing because up until now every table has an entity class but many to many relationships are special. Doctrine says, you know what, you don't need to create an entity for that joined table. Just map a many to many relationship and we will create that table for you. In fact, just by doing this if we go to our terminal and run bin console doctrine schema update--dump-sql this will show us the sql that it wants to generate after that. It is create table genus user which has a genus ID and a user ID foreign key columns. Pretty cool.

Now before we actually generate a migration for this, if you want to you can control that table name. Instead of genus user, since we're calling these genus scientists which is just a term that makes sense to us, we're going to add at join table. There's a number of different options that you can put here and these are all about how you control how the database looks. It doesn't effect your application at all. We're going to say name equals genus_scientist. With that, I'll head back to the terminal. Run bin console doctrine migrations dif. Then, we'll look here at our doctrine's migration directory. Check that new one out. It does exactly what we thought. [Altered 00:05:00] create table genus scientist but it's adding those 2 foreign key columns. Execute that with doctrine migrations. Migrate. With about 5 lines of code we have our many to many setup in the database. Next question is how do we add stuff to this? Afterwards, how do we read things out of this table? Let's do that next.
