# Controller DI Cleanup

Now fully upgraded our application to the new configuration format. It's been a lot of work. We're factoring the old application to a new one, just means a lot of work without actually enjoying any changes. Trust me, going forward this is going to feel really nice. In a few minutes, I'm going to shoot you an example where we create some new services and see how fluid the process is as you go.

What I'm going to do first is actually clean some things up. Legacy alias dot YML. Remember, we kept this because these are the old IDs and we might still be referencing them. We're just going to remove these piece by piece. First, I'm going to copy that first ID, type [inaudible 00:00:51] and you can see this is used inside of a genius controller. All right perfect. Genius controller, and yep there it is right there. No problem because we know that this is an alias to mark down transformer, so we replace this with mark down transformer, colon, colon, class. Awesome.

Now over here I'm going to go to slash genius, and then we just made that change to the show page, so then I'll click on one of our geniuses here and whoa, explosion. You have requested a non-existent app on a slash service slash mark down transformer, but we know that's a service. In fact, it's even explicitly specified right here. What's going on? Remember, these services are all private, which means they are not available at run time. This is actually one of the huge motivations behind all of this auto wiring auto configuration changes. We don't want you to fetch things out of the container at run time anymore. We want you to use dependency injection. Not only is it a better practice, but you're actually going to get better errors in your application. If you try to, for example, reference a service that doesn't exist, you're going to get a compile time error, meaning you're getting an error when you try to refresh any page across your entire site. Where as before, if you tried to reference fetch a service that didn't exist from the container, you weren't going to see that error until you actually hit that one page.

The new set up is actually more predictable than the old one. To fix things then, we need to use classic dependency injection. Which means there's two possible ways to do that in the controller. We could of course, go to the top of our controller, make a construct function, type in the mark down transformer, so that it's auto wired. Set it on a property and use it down here. That's where you should do every where except a controller. In a controller, because it's kind of tedious to do, we've added a short cut to do it. That is this. You can take that type [inaudible 00:03:11] and add it as an argument. We'll say a mark down transformer mark down transformer. Then we can remove this line down here. That's a special way of doing dependency injection that only works in controllers.

When you do this, it fixes things. Now, we can remove this first alias. Real quick, let's fix the other ones as well. We'll do a get grab on each of them, mark down extensions not actually referenced anywhere, so we can just remove that. The security that log in form authenticator is used in two places. Secure dot YML and also user controller. First, in secure dot YML, actually copy the service ID right here. It's being used in reference as an authenticator. That's fine. The new service ID is that.

Then in user controller, I'll search for authenticator. We're fetching it out of the container, so we have a new way of doing that is just to type in, log in form authenticator and I'll just say authenticator. Down here, we'll use that. That takes care of the log in form authenticator. Hash password listener, is actually not used anywhere. We'll remove that and the help form extension is also not used anywhere so we can remove that one as well. In fact, we can remove our entire legacy file. I'm going to go to the top. I'm going to get rid of our import. This is reason to celebrate. Then I'm going to delete our legacy aliases. No more legacy aliases. In fact, all our services are now private. We're using proper dependency injection on everything, except for our message manager, our last public service.

We'll get grab for that and this is of course, used just where we used it a second ago inside of genius admin controller. I'll open up genius admin controller and we know, very easy fix when you type in for message manager. Message manager, I'll copy that new variable name and we can use that below. I love it. Back in services dot YML, we can remove that last public service. Private services are good. It means that you're not referencing any of your services at run time, via container arial get. That means you will get very clear exceptions if you mess something up.

Next, let's talk about aliases.

