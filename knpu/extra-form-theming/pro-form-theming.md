# Pro Form Theming

Remove that dump. Let's refresh to look at our nice, normal form. Here's my question. In our template all we have to do is call some nice form_row functions and magically we get a lot of markup. Where is this markup coming from? I mean somewhere in the core of symfony there must be some HTML that says what an input must look like or what a form row looks like or a form start looks like. The answer is in a file way deep dark in the corner of symfony called form_div_layout.html.twig.

Now this is one of the weirdest twig templates you'll ever see. It defines a bunch of blocks and if you look through these blocks you'll eventually find every little bit of markup that's ever used. What happens is when your form is rendered, it actually opens up this template and looks for very specific blocks and uses that content to render different parts. Whenever we're rendering a text area widget it looks for a block called textarea_widget and executes this code here to fill in that part of your form. It's a very nontraditional twig template. The whole thing isn't rendered. It's almost like a list of small functions each which render just a small part of the form. Now in reality not all of our markup's coming from here. In an earlier tutorial in config.yml under the twig key, we entered a form theme key here that said to also load markup from this file bootstrap_3_layout.html.twig. This also lives deep dark in the core heart of symfony.

The idea is that it actually overrides certain blocks. There's a form widget simple and apparent one but inside the bootstrap three layout it's overridden to add some extra classes to it. Between these two templates one hundred percent of our markup is for the form. Now here's the key. The names of the blocks end up being very, very important because remember there are three parts to every field. There is the label, the widget and the error. Every field has a type. For example we have the entity type, the choice type, and the name field is the text type. Here's how symfony's form works. When you are rendering a text type like the name, and you are rendering the widget then symfony looks for the block called text_widget. That's why inside of form div layout we find one called textarea_widget. Makes perfect sense.

What about renaming label of a text area? Well you'd expect that to be textarea_label. Let's search name for textarea_label but there isn't one. It turns out that there's a bit of a hierarchy inside of these blocks. First symfony looks for textarea_label. If it finds that, it will use it. Otherwise, it'll look for form_label and use that. Form is actually the parent type for all different types, so ends up being the fall back. That makes sense because the label for a text area is not different from a label for any other field so in fact all labels are rendered in this block right here.

Another way to see that fall back mechanism is actually once again inside of your web profiler. Click the name property and go to the view variables. Every single one is going to have something called a block prefix. In fact this shows you that first it's going to look for text_widget or text_label or text_errors and if it doesn't find that it's going to fall back to form_label, form_widget, form_errors. In fact we won't talk about it but this one here overrides both of them. There is actually a way to override a single field in your form by using it's very specific name. In this case genus_form_name, but I don't do that very often.

Okay, with all that in mind, here's our goal. Look at bootstrap's forms area, under the validation section, they have a cool extra feature, that says when you have validation error, you can actually add a cute little icon. The way you do that is by adding a has feedback class to the entire div that surrounds the field and then you actually need to render the icon right down here with a form control feedback class. That's our goal.

To do that, we're going to need to override the block that renders our entire row because we're going to need to add the has feedback to the div that's around everything. Right now, that just has a form dash group on it, now it's going to need the has feedback if there's an error. Because we're rendering the row for all fields, we know it's going to be called form_row and there's the div right there. In reality this is actually overridden in our other template right here. All right, so how do we override this? Very simple. Copy it, then go into your templates directory and create a new template called _formTheme.html.twig. The name of that isn't important at all. Just to see if this is working let's add a class, cool class.

Now in order for symfony to see this, we need to go into config.yml and down here after bootstrap, we'll say _formTheme.html.twig, so because we put this after any blocks that we have in this template will override the ones in the bootstrap three template and the div layout template. Go back, refresh. Let's inspect the element and there is our cool class element right there. Very, very easy.

Here's where things get really interesting. We need to add a class but only if this field has a validation error. Well check this out. This block is using a couple variables like compound, force error invalid, so where are those coming from? Well it turns out that those are the same form variables that we had access to, that we are overriding inside of our child template. Inside of a form theme, these become local variables. I'm going to show you an example. If you just call dump with no arguments, that will dump all local variables. If you go back and refresh, now you have a big dump before every single field showing you all of the variables as local variables you have access to inside of your blocks. No matter which block you're overriding, you always have access to the same big array of variables. We can use this to only show our error icon when there's a validation error. Flush way our dump function and do that.

I'll set a new variable called show error icon and let's actually copy all of this logic right here. Now, most important thing here is that there is a variable called valid. If that's true, that's false, then there is a validation error. This compound thing, that is something we're going to talk about later. Actually we normally think of fields as just a single field, but sometimes a field as actually consists of multiple sub-fields and I'll show you that towards the end of the tutorial. Now over here, I'll use an inline if statement to say if show error icon then we'll add space has feedback, otherwise we'll do nothing. Down below right after the form widget, we'll do if show error icon then we'll add our glyph icon. Perfect. Let's go back. Refresh. You're not seeing it now because there's no validation errors. Let's take off the name field, submit, and that's beautiful.

You can totally delete this part. Now set the sub-family [inaudible 00:12:02] string. That shows up too and actually it highlights part of the problem. Over here because of this drop down icon, that looks a little funny and in fact if you read the bootstrap documentation, it basically tells you that this should only be added to text elements not everything. In fact we need to do a little bit more work so this doesn't show up everywhere. In fact it will start looking really, really funny with check boxes and other things. Let's do that next.
